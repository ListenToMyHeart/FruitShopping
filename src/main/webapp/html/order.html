<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.0, user-scalable=0">
		<title>订单管理</title>
		<link href="../css/admin.css" rel="stylesheet" type="text/css">
		<link href="../css/amazeui.css" rel="stylesheet" type="text/css">
		<link href="../css/personal.css" rel="stylesheet" type="text/css">
		<link href="../css/orstyle.css" rel="stylesheet" type="text/css">
		<script src="../js/jquery.min.js"></script>
		<script src="../js/amazeui.js"></script>
		<script src="../js/util.js"></script>
		<style>
			.marginleft{
				margin-left: 20px !important;
			}

			.img-small{
				height: 78px;
				width: 78px;
			}

			body{
				overflow:scroll;
				overflow-x:hidden;
				overflow-y:hidden;
			}
			.fontcolor{
				color: dodgerblue;
			}
			.finishcolor{
				color:red;
			}

			/*body{
				position:fixed;
			}*/
		</style>
	</head>
	<body>

					<div class="user-order marginleft">
						<!--标题 -->
						<div class="am-cf am-padding">
							<div class="am-fl am-cf"><strong class="am-text-danger am-text-lg">订单管理</strong> / <small>Order</small></div>
						</div>
						<hr/>
						<div class="am-tabs am-tabs-d2 am-margin" data-am-tabs>
							<ul class="am-avg-sm-5 am-tabs-nav am-nav am-nav-tabs">
								<li class="am-active"><a href="#tab1">等待处理的订单</a></li>
								<li><a href="#tab2">待付款</a></li>
								<li><a href="#tab3">待发货</a></li>
								<li><a href="#tab4">待收货</a></li>
								<li><a href="#tab5">已完成订单</a></li>
							</ul>

							<div class="am-tabs-bd">
								<div class="am-tab-panel am-fade am-in am-active" id="tab1">
									<div class="order-top">
										<div class="th th-item">
											<td class="td-inner">商品</td>
										</div>
										<div class="th th-price">
											<td class="td-inner">单价</td>
										</div>
										<div class="th th-number">
											<td class="td-inner">数量</td>
										</div>
										<div class="th th-operation">
											<td class="td-inner">商品操作</td>
										</div>
										<div class="th th-amount">
											<td class="td-inner">合计</td>
										</div>
										<div class="th th-status">
											<td class="td-inner">交易状态</td>
										</div>
										<div class="th th-change">
											<td class="td-inner">交易操作</td>
										</div>
									</div>

									<div class="order-main">
										<div class="order-list" id="waitHandlerOrder">
										</div>

									</div>

								</div>
								<div class="am-tab-panel am-fade" id="tab2">

									<div class="order-top">
										<div class="th th-item">
											<td class="td-inner">商品</td>
										</div>
										<div class="th th-price">
											<td class="td-inner">单价</td>
										</div>
										<div class="th th-number">
											<td class="td-inner">数量</td>
										</div>
										<div class="th th-operation">
											<td class="td-inner">商品操作</td>
										</div>
										<div class="th th-amount">
											<td class="td-inner">合计</td>
										</div>
										<div class="th th-status">
											<td class="td-inner">交易状态</td>
										</div>
										<div class="th th-change">
											<td class="td-inner">交易操作</td>
										</div>
									</div>

									<div class="order-main">
										<div class="order-list" id="waitPayOrder">
										</div>
									</div>
								</div>
								<div class="am-tab-panel am-fade" id="tab3">
									<div class="order-top">
										<div class="th th-item">
											<td class="td-inner">商品</td>
										</div>
										<div class="th th-price">
											<td class="td-inner">单价</td>
										</div>
										<div class="th th-number">
											<td class="td-inner">数量</td>
										</div>
										<div class="th th-operation">
											<td class="td-inner">商品操作</td>
										</div>
										<div class="th th-amount">
											<td class="td-inner">合计</td>
										</div>
										<div class="th th-status">
											<td class="td-inner">交易状态</td>
										</div>
										<div class="th th-change">
											<td class="td-inner">交易操作</td>
										</div>
									</div>

									<div class="order-main">
										<div class="order-list" id="waitSendOrder">
										</div>
									</div>
								</div>
								<div class="am-tab-panel am-fade" id="tab4">
									<div class="order-top">
										<div class="th th-item">
											<td class="td-inner">商品</td>
										</div>
										<div class="th th-price">
											<td class="td-inner">单价</td>
										</div>
										<div class="th th-number">
											<td class="td-inner">数量</td>
										</div>
										<div class="th th-operation">
											<td class="td-inner">商品操作</td>
										</div>
										<div class="th th-amount">
											<td class="td-inner">合计</td>
										</div>
										<div class="th th-status">
											<td class="td-inner">交易状态</td>
										</div>
										<div class="th th-change">
											<td class="td-inner">交易操作</td>
										</div>
									</div>

									<div class="order-main">
										<div class="order-list" id="waitGoodsOrder">
										</div>
									</div>
								</div>

								<div class="am-tab-panel am-fade" id="tab5">
									<div class="order-top">
										<div class="th th-item">
											<td class="td-inner">商品</td>
										</div>
										<div class="th th-price">
											<td class="td-inner">单价</td>
										</div>
										<div class="th th-number">
											<td class="td-inner">数量</td>
										</div>
										<div class="th th-operation">
											<td class="td-inner">商品操作</td>
										</div>
										<div class="th th-amount">
											<td class="td-inner">合计</td>
										</div>
										<div class="th th-status">
											<td class="td-inner">交易状态</td>
										</div>
										<div class="th th-change">
											<td class="td-inner">交易操作</td>
										</div>
									</div>

									<div class="order-main">
										<div class="order-list" id="finishedOrder">
											<!--不同状态的订单	-->
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
			<script>
				$(function(){
					show();
				});

				function show() {
					var jsondata;
					var jsongoods;
					$('#waitPayOrder').html("");
					$('#waitGoodsOrder').html("");
					$('#finishedOrder').html("");
					$('#waitSendOrder').html("");
					$('#waitHandlerOrder').html("");

					$.ajax({
						url:getContextPath()+"orderInformation/member/orders",
						type:'get',
						dataType:'json',
						success:function (data) {
							if(data.success)
							{
								for(var i=0;i<data.orderInformation.length;i++){
									jsondata=data.orderInformation[i];
									jsongoods=data.goodsInformation[i];
									var s='<div class="order-status4"> <div class="order-title"> <div class="dd-num">订单编号：<a href="javascript:;">'+jsondata.orderid+'</a></div> <span>'+jsondata.orderdate+'</span> </div>'
											+'<div class="order-content"> <div class="order-left"> <ul class="item-list"> <li class="td td-item"> <div class="item-pic"> <a href="#" class="J_MakePoint"> <img src="'+jsongoods.goodsurl+'" class="itempic J_ItemImg img-small"> </a> </div>'
											+'<div class="item-info"> <div class="item-basic-info"> <a href="#"> <p>'+jsongoods.goodsid+" "+jsongoods.classid+'</p></a> </div> </div> </li>'
											+'<li class="td td-price"> <div class="item-price">'+jsondata.goodsprice+'</div> </li> <li class="td td-number"> <div class="item-number"> <span>×</span>'+jsondata.isconfirm+' </div> </li>';

									if(jsondata.status=="未提交"){
										var s1=s+'<li class="td td-operation"> <div class="item-operation "> <a  href="#" class="fontcolor" onclick="buyIt(this)" id="'+jsondata.orderid+'">购买</a>/<a  href="#" class="fontcolor" onclick="cancelOrder(this)" id="'+jsondata.orderid+'">取消订单</a> </div> </li> </ul> </div> <div class="order-right"> <li class="td td-amount"> <div class="item-amount">合计：'+jsondata.totalprice+' </div> </li>'
												+'<div class="move-right"> <li class="td td-status"> <div class="item-status"> <p class="Mystatus">买家未付款</p> '
									        	+' </div> </li>  </div> </div> </div> </div>';

										$('#waitPayOrder').append(s1);
									}
									else if(jsondata.status=="已发货")
									{
										var s1=s+'<li class="td td-operation"> <div class="item-operation"> <a href="#" onclick="receiveTheGoods(this)" id="'+jsondata.orderid+'">确认收货</a>/<a href="#" onclick="refund(this)" id="'+jsondata.orderid+'">退货</a> </div> </li> </ul> </div> <div class="order-right"> <li class="td td-amount"> <div class="item-amount">合计：'+jsondata.totalprice+' </div> </li>'
												+'<div class="move-right"> <li class="td td-status"> <div class="item-status"> <p class="Mystatus">卖家已发货</p> '
												+' </div> </li>  </div> </div> </div> </div>';

										$('#waitGoodsOrder').append(s1);

									}
									else if(jsondata.status=="已收货" || jsondata.status=="已退货"){
										var s1=s+'<li class="td td-operation"> <div class="item-operation"> <a href="#" onclick="cancelOrder(this)" id="'+jsondata.orderid+'" >删除订单</a> </div> </li> </ul> </div> <div class="order-right"> <li class="td td-amount"> <div class="item-amount">合计：'+jsondata.totalprice+' </div> </li>'
												+'<div class="move-right"> <li class="td td-status"> <div class="item-status"> <p class="Mystatus">'+jsondata.status+'</p> '
												+' </div> </li>  </div> </div> </div> </div>';

										$('#finishedOrder').append(s1);

									}
									else if(jsondata.status=="未接收" || jsondata.status=="未发货"){
										var s1=s+'<li class="td td-operation"> <div class="item-operation"> <a href="#" onclick="refund(this)" id="'+jsondata.orderid+'">退款</a> </div> </li> </ul> </div> <div class="order-right"> <li class="td td-amount"> <div class="item-amount">合计：'+jsondata.totalprice+' </div> </li>'
												+'<div class="move-right"> <li class="td td-status"> <div class="item-status"> <p class="Mystatus">买家已付款</p>'
												+' </div> </li>  </div> </div> </div> </div>';

										$('#waitSendOrder').append(s1);
									}
									else if(jsondata.status=="申请退款"|| jsondata.status=="申请退货"){
										var s1=s+'<li class="td td-operation"> <div class="item-operation"> <a href="#">等待处理中</a> </div> </li> </ul> </div> <div class="order-right"> <li class="td td-amount"> <div class="item-amount">合计：'+jsondata.totalprice+' </div> </li>'
												+'<div class="move-right"> <li class="td td-status"> <div class="item-status"> <p class="Mystatus">退款退货等待</p>'
												+' </div> </li>  </div> </div> </div> </div>';

										$('#waitHandlerOrder').append(s1);
									}
								}
							}

						}
					});
				}
				function cancelOrder(me) {
					var orderid=$(me).attr("id");
					$.ajax({
						url:getContextPath()+"orderInformation/orders/"+orderid,
						type:'delete',
						dataType:'json',
						success:function (data) {
							if(data.success){
								show();
							}
							else {
								alert("操作失败");
							}
						}
					})
				}


				function receiveTheGoods(me) {

					var orderid=$(me).attr("id");
					var jsondata={status:"已收货",orderid:orderid};
					$.ajax({
						url:getContextPath()+"orderInformation/updateOrderInformation/"+orderid,
						type:'put',
						contentType:'application/json',
						dataType:'json',
						data:JSON.stringify(jsondata),
						success:function (data) {
							if(data.success)
							{
								show();
								alert("确认收货成功");
							}
							else{
								alert("确认收货失败");
							}
						}
					})

				}

				function buyIt(me) {
					var orderid = $(me).attr("id");
					window.open(getContextPath()+"html/pay.html?keyword="+orderid);
				}

				function refund(me) {
					var orderid = $(me).attr("id");
					window.location.href=getContextPath()+"html/refund.html?keyword="+orderid;
				}
			</script>


	</body>

</html>